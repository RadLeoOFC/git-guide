# Работа с удалёнными репозиториями

Этот раздел про взаимодействие с удалёнными репозиториями: как **отправлять** (push), **забирать** (fetch) и **получать+сливать** (pull) изменения. Также разберём отслеживаемые ветки и безопасные практики.

---

## Базовая настройка удалённого репозитория

```bash
git remote add origin https://github.com/user/project.git   # добавить удалённый
git remote -v                                               # показать список удалённых
git remote set-url origin <new-url>                         # изменить URL
```
*Термины:* `origin` — имя удалённого по умолчанию. «Отслеживаемая ветка» — локальная ветка, связанная с удалённой (`origin/branch`).

---

## `git push` — отправка изменений

Отправляет коммиты из **текущей локальной ветки** в связанный удалённый репозиторий.

```bash
git push                        # если ветка уже отслеживается
git push -u origin main         # впервые: установить апстрим (tracking) и запомнить
git push origin feature-x       # отправить конкретную ветку
git push --tags                 # отправить все теги
```

**О перезаписи истории:**
```bash
git push --force                # перезапишет удалённую ветку без проверок (опасно)
git push --force-with-lease     # перезапишет только если на сервере нет новых чужих коммитов (предпочтительно)
```
- `--force-with-lease` защищает от случайного уничтожения чужой работы ✔️.

---

## `git fetch` — забрать изменения без слияния

Загружает новые коммиты и обновляет удалённые ссылки (`origin/branch`), **не изменяя** вашу рабочую ветку и файлы.

```bash
git fetch origin                # забрать обновления с origin
git fetch origin main           # забрать конкретную ветку
git fetch --all                 # забрать со всех настроенных удалённых веток
git fetch --prune               # удалить локальные ссылки на удалённые ветки, которых больше нет
```

Полезно делать регулярно: видите, что изменилось на сервере, прежде чем сливать.

---

## `git pull` — забрать и слить (fetch + merge/rebase)

По умолчанию `pull` делает `fetch`, а затем **merge** в текущую ветку.

```bash
git pull                        # из отслеживаемой ветки
git pull origin main            # из конкретной удалённой/ветки в текущую
git pull --rebase               # переписать ваши коммиты поверх полученных (чище история)
```

**Замечания по rebase:**
- Удобно для локальной работы, но **не ребейзьте уже опубликованные коммиты** в общих ветках.
- Можно включить по умолчанию только для локальных веток:
  ```bash
  git config --global pull.rebase true
  ```

---

## Типовой рабочий цикл с удалёнными

```bash
git fetch origin                 # увидеть, что нового на сервере
git switch feature-x             # перейти на свою ветку
git rebase origin/main           # актуализировать историю (или: git merge origin/main)
# поработали, закоммитили
git push -u origin feature-x     # запушить ветку (первый раз с -u)
```

---

## Чистка и синхронизация

```bash
git fetch --prune                # убрать «висячие» удалённые ссылки
git remote prune origin          # жёстче: подчистить ссылки для конкретного удалённого
```

---

## Частые ошибки и как их избежать

- **`rejected - non-fast-forward`** — на сервере есть новые коммиты. Сделайте `git fetch`, затем `git merge`/`git rebase`, и повторите `push`.
- **Слишком частый `--force`** — используйте `--force-with-lease` и предпочитайте Pull Request'ы.
- **Нет отслеживаемой ветки** — добавьте `-u` при первом пуше или:
  ```bash
  git branch --set-upstream-to=origin/feature-x
  ```

---

## Памятка команд

```bash
# PUSH
git push [-u] origin <branch>       # отправить ветку
git push --force-with-lease         # безопаснее, чем --force
git push --tags                     # отправить теги

# FETCH
git fetch [origin] [<branch>]       # забрать обновления
git fetch --all --prune             # со всех удалённых + чистка

# PULL
git pull [origin] [<branch>]        # забрать и слить
git pull --rebase                   # забрать и переписать поверх
```
➡️ [Следующий раздел: История и откаты в Git](06-history-revert.md)
